#!/usr/bin/env bash
set -euo pipefail

args=()
topic_idx=-1
topic_value=""

for ((i=1; i<=$#; i++)); do
  arg="${!i}"
  args+=("$arg")
  if [[ "$arg" == "--topic" ]]; then
    topic_idx=$((i))
    next_i=$((i + 1))
    if [[ $next_i -le $# ]]; then
      topic_value="${!next_i}"
    fi
  fi
done

if [[ $topic_idx -gt 0 ]]; then
  case "${topic_value,,}" in
    general|news|finance)
      ;;
    *)
      # Tavily only accepts specific topic values. Fall back to news instead of failing.
      args[$topic_idx]="news"
      ;;
  esac
fi

exec node /home/node/.openclaw/skills/tavily-search/scripts/search.mjs "${args[@]}"
